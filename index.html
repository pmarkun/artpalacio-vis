<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
        <link href='//api.tiles.mapbox.com/mapbox.js/v1.5.1/mapbox.css' rel='stylesheet' />
        <script src='//api.tiles.mapbox.com/mapbox.js/v1.5.1/mapbox.js'></script>
        <script type="text/javascript" src="js/d3.v3.min.js"></script>
        <style type="text/css">
            #map { position:absolute; width:100%; height:100%; }
            #map-basic { width:960px;height:600px; }
        </style>
    </head>
    <body>
    <div id='map-basic'></div>
    <button id="go">Go</button>
    <a href="https://docs.google.com/spreadsheet/pub?key=0ArwVSoc8z4afdDlOcDkyQ1E1aUw4dGdGOXVFRmhCeFE&single=true&gid=0&output=csv">dados originais</a>
    
    <script type="text/javascript">
    var pessoas = [];
    var map = L.mapbox.map('map-basic', 'examples.map-9ijuk24y')
            .setView([-23.54, -46.63], 2);
                               
   move = function(marker, latlngs, index, wait) {
        marker.setLatLng(latlngs[index]).update();
        marker.update();
        if(index != latlngs.length-1) {
            // call the next "frame" of the animation
            setTimeout(function() { 
                move(marker, latlngs, index+1, wait); 
            }, wait);
        }
    };
    
    d3.csv("https://docs.google.com/spreadsheet/pub?key=0ArwVSoc8z4afdDlOcDkyQ1E1aUw4dGdGOXVFRmhCeFE&single=true&gid=0&output=csv", function (data) {
            L.marker([-23.54, -46.63]).addTo(map);
            for (i in data) {
                var lat = parseFloat(data[i]['geo_latitude']);
                var lng = parseFloat(data[i]['geo_longitude']);
                if (lat) {
                    var pessoa = L.marker([lat,lng], { 'title' : data[i]['Nome'], 'opacity' : 0.8 });
                    pessoa.addTo(map);
                    pessoas.push(pessoa);
            }
        }
        });
        d3.select("#go").on("click", function () {
            for (p in pessoas) {
            pessoa = pessoas[p]
            var frames = [];
                    for (var percent = 0; percent < 1; percent += 0.01) {
                        curLat = pessoa._latlng.lat + (-23.54 - pessoa._latlng.lat) * percent;
                        curLng = pessoa._latlng.lng + (-46.63 - pessoa._latlng.lng) * percent;
                        frames.push(L.latLng(curLat, curLng));
                    }
                move(pessoa, frames, 0, 10);
            }
        })
    </script>
    </body>
</html>